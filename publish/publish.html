<!DOCTYPE html>
<html style="height: 100%;">

	<head>
		<meta charset="UTF-8">
		<meta name="viewport" content="width=device-width,initial-scale=1,minimum-scale=1,maximum-scale=1,user-scalable=no" />
		<title></title>
		<link rel="stylesheet" type="text/css" href="../css/ionic.min.css" />
		<link rel="stylesheet" type="text/css" href="../css/iconfont.css" />
		<link rel="stylesheet" type="text/css" href="../css/main.css" />
		<link rel="stylesheet" type="text/css" href="../css/mobileSelect.css" />
		<script src="../js/jquery-2.2.2.min.js" type="text/javascript" charset="utf-8"></script>
		<script src="../js/ionic.bundle.min.js" type="text/javascript" charset="utf-8"></script>
		<script src="../js/city.js" type="text/javascript" charset="utf-8"></script>
		<script src="../js/picker.min.js" type="text/javascript" charset="utf-8"></script>
		<script src="../js/mobileSelect.min.js" type="text/javascript" charset="utf-8"></script>
			<style>
		.Ms{height: 40px;line-height: 40px;background: white;padding:0 16px;font-size: 20px;}
		.pub{
		display: flex;
		padding:0 16px;
			background: white;
		}
		.delete{
		margin: 0 5px 5px 0;
		width:100px;
			height:110px;
		display: flex;
			position: relative;
		}
		.delete>i{
		display: none;
		position: absolute;
		right: 5px;
		top:2px;
			font-size: 20px;
			color: #ef473a;
		}
		.delete>img{
			width:100px;
			height:110px;
		}
		
		</style>
	</head>

	<body ng-controller="PopupCtrl" class="Edit_body">
		<div class="bar bar-header bar-assertive Edit_header">
			<button class="button button-clear pull-left Edit_header_btn" id="fanhui" id="Return"><i class="icon iconfont icon-fanhui1"></i></button>
			<h3 class="title Edit_header_title">发布信息</h3>
		</div>
		<div class="publish_tip" style="margin-top: 53px;">
			<p>负责声明：平台发布的所有信息免费；平台只负责发布，展示，与平台本身无关，平台不负任何责任。</p>
		</div>
	
		<div class="content" style="padding: 0px 3% 0 3%;margin-bottom: 60px;">
			<div class="M-LS" style="margin-top: 8px;">
				<span>推广期限：</span>
				<button class="button button-outline button-light M-LB" id="sel_date">点击选取推广期限<span class="caret"></span></button>
			</div>
			<div class="M-LS">
				<span>推广区域：</span>
				<button class="sel_city button button-outline button-light M-LB" id="sel_city">点击选取省市区县<span class="caret"></span></button>
			</div>
			<div class="M-LS">
				<span>推广项目：</span>
				<button class="button button-outline button-light M-LB" id="fenlei">点击选取项目分类<span class="caret"></span></button>
			</div>
			<div class="M-LS" style="margin: 8px 0 0 0;">
				<span>信息内容</span>
			</div>
			<div style="margin-top: 8px;">
				<textarea name="" placeholder="请输入发布内容" style="width: 100%;height: 300px;padding: 16px;"></textarea>
			</div>
			<div class="M-LS" style="margin: 8px 0 0 0;">
				<span>推广物品：请上传图片</span>
			</div>
			<div class="pub"></div>
			<a class="btn_addPic" href="#" style="margin: 8px auto;background-color: #FFFFFF;">
				<span><em>+</em>添加图片</span>
				<input class="file my_img" type="file"  style="display:none;"/>
			</a>
			<button type="button" class="button button-assertive button-full" id="shenhe">提交审核</button>
		</div>
		<!--底部-->
		<div class="tabs tabs-icon-top footer-bar">
			<a class="tab-item footer-L33" href="../index.html">
				<i class="icon iconfont icon-shouye footer-icon"></i>
				<span>首页</span>
			</a>
			<a class="tab-item footer-L33" href="../message/message.html">
				<i class="icon iconfont icon-zixun footer-icon"></i>
				<span>资讯</span>
			</a>
			<a class="tab-item footer-L33 footer-active" href="publish.html">
				<i class="icon iconfont icon-paperplane footer-icon"></i>
				<span>发布信息</span>
			</a>
			<a class="tab-item footer-L33" href="#">
				<i class="icon iconfont icon-qiyeruzhu footer-icon"></i>
				<span>入驻</span>
			</a>
			<a class="tab-item footer-L33" href="../user/User.html">
				<i class="icon iconfont icon-04 footer-icon"></i>
				<span>我的</span>
			</a>
		</div>
	</body>
	<script src="../js/localResizeIMG.js"></script>
    <script src="../js/mobileBUGFix.mini.js"></script>
    <script src="../js/ResizeIMG.js"></script>
	<script type="text/javascript">
	//手机端获取相册和拍照	
$(function () {
            //上传图片!!!!!!!!!!!!!!!!!!!!
            $('.btn_addPic>span').click(function(){  
			$('.file').click();
		})
            $('.file').ResizeIMG({
                width: 100,
                quality: 1.0,
                success: function (result) {
                    console.log(result);
                    $('.pub').append('<a class="delete"><img class="add-img" src=""/><i class="x icon ion-close-circled"></i></a>');
                    $('.pub img').last().attr('src',result.base64);
                        //	删除图片操作
	$('.delete').hover(function(){
		$(this).children('i').css({display:'block'})
	},function(){
		$(this).children('i').css({display:'none'})
	})
	$('.x').click(function(){
		$(this).parent().remove()
	})
                }
            
            });
            var rem_width=parseInt($("body").css("width"))/7.5;
            $(".yb-view").scrollLeft(1.44*rem_width);
        });
        
        
        
		$('#fanhui').click(function() {
			window.history.go(-1);
		})

		//选择分类
		var fenlei = new MobileSelect({
			trigger: '#fenlei',
			title: '选择分类',
			wheels: [{
				data: [{
					id: '1',
					value: '采购'
				}, {
					id: '2',
					value: '顺风车',
					childs: [{
						id: '1',
						value: '人找车'
					}, {
						id: '2',
						value: '车找人'
					}, {
						id: '3',
						value: '货找车'
					}, {
						id: '4',
						value: '车找货'
					}, ]
				}, {
					id: '3',
					value: '有赏需求'
				}, {
					id: '4',
					value: '找资金'
				}, {
					id: '5',
					value: '求职招聘'
				}, {
					id: '6',
					value: '销售'
				}, {
					id: '7',
					value: '办事服务'
				}, {
					id: '8',
					value: '择偶交友'
				}, ]
			}],
			transitionEnd: function(indexArr, data) {
				console.log(data);
			},
			callback: function(indexArr, data) {
				console.log(data);
			}
		});

		//地址选择初始化1
		var nameEl = document.getElementsByClassName('sel_city')[0];
		var first = []; /* 省，直辖市 */
		var second = []; /* 市 */
		var third = []; /* 镇 */
		var selectedIndex = [0, 0, 0]; /* 默认选中的地区 */
		var checked = [0, 0, 0]; /* 已选选项 */
		function creatList(obj, list) {
			obj.forEach(function(item, index, arr) {
				var temp = new Object();
				temp.text = item.name;
				temp.value = index;
				list.push(temp);
			})
		}
		creatList(city, first);
		if(city[selectedIndex[0]].hasOwnProperty('sub')) {
			creatList(city[selectedIndex[0]].sub, second);
		} else {
			second = [{
				text: '',
				value: 0
			}];
		}
		if(city[selectedIndex[0]].sub[selectedIndex[1]].hasOwnProperty('sub')) {
			creatList(city[selectedIndex[0]].sub[selectedIndex[1]].sub, third);
		} else {
			third = [{
				text: '',
				value: 0
			}];
		}
		var picker = new Picker({
			data: [first, second, third],
			selectedIndex: selectedIndex,
			title: '地址选择'
		});
		picker.on('picker.select', function(selectedVal, selectedIndex) {
			var text1 = first[selectedIndex[0]].text;
			var text2 = second[selectedIndex[1]].text;
			var text3 = third[selectedIndex[2]] ? third[selectedIndex[2]].text : '';
			nameEl.innerText = text1 + ' ' + text2 + ' ' + text3;
		});
		picker.on('picker.change', function(index, selectedIndex) {
			if(index === 0) {
				firstChange();
			} else if(index === 1) {
				secondChange();
			}

			function firstChange() {
				second = [];
				third = [];
				checked[0] = selectedIndex;
				var firstCity = city[selectedIndex];
				if(firstCity.hasOwnProperty('sub')) {
					creatList(firstCity.sub, second);

					var secondCity = city[selectedIndex].sub[0]
					if(secondCity.hasOwnProperty('sub')) {
						creatList(secondCity.sub, third);
					} else {
						third = [{
							text: '',
							value: 0
						}];
						checked[2] = 0;
					}
				} else {
					second = [{
						text: '',
						value: 0
					}];
					third = [{
						text: '',
						value: 0
					}];
					checked[1] = 0;
					checked[2] = 0;
				}

				picker.refillColumn(1, second);
				picker.refillColumn(2, third);
				picker.scrollColumn(1, 0)
				picker.scrollColumn(2, 0)
			}

			function secondChange() {
				third = [];
				checked[1] = selectedIndex;
				var first_index = checked[0];
				if(city[first_index].sub[selectedIndex].hasOwnProperty('sub')) {
					var secondCity = city[first_index].sub[selectedIndex];
					creatList(secondCity.sub, third);
					picker.refillColumn(2, third);
					picker.scrollColumn(2, 0)
				} else {
					third = [{
						text: '',
						value: 0
					}];
					checked[2] = 0;
					picker.refillColumn(2, third);
					picker.scrollColumn(2, 0)
				}
			}

		});
		picker.on('picker.valuechange', function(selectedVal, selectedIndex) {
			console.log(selectedVal);
			console.log(selectedIndex);
		});

		nameEl.addEventListener('click', function() {
			picker.show();
		});

		//身份
		var dateArr = ['1天', '7天', '15天', '一个月'];
		var mobileSelect1 = new MobileSelect({
			trigger: '#sel_date',
			title: '选择推广日期',
			wheels: [{
				data: dateArr
			}],
			position: [2], //初始化定位 打开时默认选中的哪个 如果不填默认为0
			transitionEnd: function(indexArr, data) {
				//console.log(data);
			},
			callback: function(indexArr, data) {
				console.log(data);
			}
		});

		$('#shenhe').click(function() {
			window.location.href = 'publishSuccess.html';
		})
	</script>

</html>